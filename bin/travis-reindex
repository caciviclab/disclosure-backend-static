#!/bin/bash
set -euo pipefail

if [ "${TRAVIS_EVENT_TYPE}" = "pull_request" -o ! "${TRAVIS_BRANCH}" = "master" ]; then
  echo "Not reindexing in Algolia because this looks like a Github PR."
  exit
fi

if git diff --exit-code --quiet -- . ':(exclude)build/_data/stats.json'; then
  echo "No changes to reindex. Exiting."
  exit
fi

echo "Reindexing into Algolia..."

search_args=""
if [ "$(date +%A)" != "Monday" ]; then
  echo "Skipping contributor list indexing because it's not Monday."
  search_args+="--skip-contributors"
fi

ruby ./search_index.rb $search_args
